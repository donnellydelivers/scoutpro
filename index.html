<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ScoutPro v5.3</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0d0f12;
  --card: #1e2329;
  --border: rgba(255,255,255,.08);
  --text: #f0f2f5;
  --muted: #9aa3ad;
  --green: #00d68f;
  --red: #ff6b6b;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'DM Sans',sans-serif;
}

.app {
  max-width:430px;
  margin:auto;
  min-height:100vh;
}

header {
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--border);
}

input {
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:2px solid var(--border);
  background:#12151a;
  color:white;
}

.card {
  margin:16px;
  border-radius:16px;
  background:var(--card);
  border:1px solid var(--border);
  overflow:hidden;
  display:none;
}

.banner {
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.buy { background:rgba(0,214,143,.1); border-bottom:2px solid var(--green); }
.pass { background:rgba(255,107,107,.1); border-bottom:2px solid var(--red); }

.metric {
  padding:12px;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-between;
}
.small { font-size:12px; color:var(--muted); }
.big { font-family:'DM Mono'; font-size:18px; }

</style>
</head>

<body>
<div class="app">

<header>
  <strong>ScoutPro</strong>
  <span id="tokenDisplay" class="small"></span>
</header>

<div style="padding:16px">
  <input id="barcodeInput" placeholder="Scan barcode..." inputmode="numeric" autocomplete="off" />
</div>

<div id="resultCard" class="card">
  <div id="decisionBanner" class="banner">
    <div>
      <div id="decisionLabel" class="big"></div>
      <div id="decisionReason" class="small"></div>
    </div>
    <div id="profitValue" class="big"></div>
  </div>

  <div class="metric">
    <span class="small">Lowest New (Prime)</span>
    <span id="lowFBA"></span>
  </div>
  <div class="metric">
    <span class="small">Lowest New (Landed)</span>
    <span id="lowFBM"></span>
  </div>
  <div class="metric">
    <span class="small">Amazon Price</span>
    <span id="amzPrice"></span>
  </div>
  <div class="metric">
    <span class="small">Avg Rank</span>
    <span id="avgRank"></span>
  </div>
  <div class="metric">
    <span class="small">ROI</span>
    <span id="roiVal"></span>
  </div>
</div>

</div>

<script>
const apiKey = localStorage.getItem('scoutProKey');
const input = document.getElementById('barcodeInput');
const card = document.getElementById('resultCard');

input.focus();

input.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    fetchKeepa(input.value.trim());
  }
});

async function fetchKeepa(code) {
  card.style.display = 'none';

  const url = `https://api.keepa.com/product?key=${apiKey}&domain=1&code=${code}&stats=1`;
  const res = await fetch(url);
  const data = await res.json();

  document.getElementById('tokenDisplay').textContent =
    data.tokensLeft ? `${data.tokensLeft} tokens` : '';

  if (!data.products || !data.products[0]) return;
  render(data.products[0]);
}

function render(p) {
  const c = p.stats.current;

  const priceAmazon = c[0] > 0 ? c[0]/100 : null;
  const priceFBMraw = c[1] > 0 ? c[1]/100 : null;
  const priceFBA = c[10] > 0 ? c[10]/100 : null;
  const priceLandedNew = c[18] > 0 ? c[18]/100 : null;

  const priceUsedLanded = c[17] > 0 ? c[17]/100 : null;
  const priceUsedRaw = c[7] > 0 ? c[7]/100 : null;

  const lowestNew =
    priceFBA ??
    priceAmazon ??
    priceLandedNew ??
    priceFBMraw ??
    null;

  const lowestUsed =
    priceUsedLanded ??
    priceUsedRaw ??
    null;

  const buyCost = 1.00;
  const sellPrice = lowestNew || 0;

  const fees = sellPrice * 0.15 + 4.5;
  const profit = sellPrice - buyCost - fees;
  const roi = buyCost ? (profit / buyCost * 100) : 0;

  const decision = profit >= 5 ? 'BUY' : 'PASS';

  document.getElementById('decisionLabel').textContent = decision;
  document.getElementById('decisionReason').textContent = profit >= 5 ? 'Profitable' : 'Low margin';
  document.getElementById('profitValue').textContent = '$' + profit.toFixed(2);

  document.getElementById('decisionBanner').className =
    'banner ' + (decision === 'BUY' ? 'buy' : 'pass');

  document.getElementById('lowFBA').textContent = priceFBA ? `$${priceFBA.toFixed(2)}` : '--';
  document.getElementById('lowFBM').textContent =
    priceLandedNew ? `$${priceLandedNew.toFixed(2)}` :
    priceFBMraw ? `$${priceFBMraw.toFixed(2)}` : '--';

  document.getElementById('amzPrice').textContent =
    priceAmazon ? `$${priceAmazon.toFixed(2)}` : '--';

  document.getElementById('avgRank').textContent =
    c[3] ? c[3].toLocaleString() : '--';

  document.getElementById('roiVal').textContent = roi.toFixed(0) + '%';

  card.style.display = 'block';

  navigator.vibrate(decision === 'BUY' ? [60] : [20,20]);

  setTimeout(() => {
    input.value = '';
    input.focus();
  }, 700);
}
</script>
</body>
</html>
