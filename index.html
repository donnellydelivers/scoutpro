<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>ScoutPro AI v3.5 (FULL – Scanner & Settings Fixed)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
/* ================= CORE THEME ================= */
:root{--bg:#0a0e1a;--panel:#141b2d;--card:#1a2332;--border:rgba(255,255,255,.08);--text:#fff;--muted:#8b92ab;--green:#10b981;--yellow:#fbbf24;--red:#ef4444;--blue:#3b82f6}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
.app{max-width:480px;margin:0 auto;min-height:100vh;padding-bottom:140px}
input{font-size:16px}
button{cursor:pointer}

/* ================= CRITICAL FIXES ================= */
#settingsBtn{z-index:9999!important;pointer-events:auto!important}
.status-bar{pointer-events:none}

/* ================= HEADER ================= */
header{position:sticky;top:0;z-index:100;background:var(--bg);padding:12px;border-bottom:1px solid var(--border)}
.input-row{display:grid;grid-template-columns:1fr auto auto;gap:8px}
input[type=text]{padding:14px 16px;border-radius:12px;background:var(--panel);border:1px solid var(--border);color:var(--text);font-family:JetBrains Mono}
button{padding:14px 16px;border-radius:12px;border:none;font-weight:600}
.btn-settings{background:var(--card);color:var(--muted)}
.btn-history{background:var(--yellow);color:#000}

.status-bar{padding:10px 16px;font-family:JetBrains Mono;font-size:12px;color:var(--muted);background:var(--panel);margin:12px;border-radius:8px;display:flex;justify-content:space-between}

.card{margin:12px;background:var(--panel);border-radius:16px;border:1px solid var(--border)}
.hidden{display:none}

.actions{position:fixed;bottom:0;left:0;right:0;max-width:480px;margin:0 auto;padding:16px;display:flex;gap:10px;background:linear-gradient(to top,var(--bg) 70%,transparent)}
.actions button{flex:1}
.btn-download{background:var(--green);color:#000}
.btn-clear{background:var(--red);color:#fff}
</style>
</head>
<body>
<div class="app">
<header>
  <div class="input-row">
    <input id="scanInput" type="text" placeholder="Scan ISBN / ASIN" autocomplete="off" />
    <button id="settingsBtn" class="btn-settings">⚙️</button>
    <button id="historyBtn" class="btn-history">History</button>
  </div>
</header>

<div class="status-bar">
  <span id="statusText">Ready to scan</span>
  <span id="itemCount">Queue: 0</span>
</div>

<div class="card hidden" id="resultCard">
  <div style="padding:20px">
    <h2 id="decision">—</h2>
    <div id="resultText" style="margin-top:12px;font-size:14px"></div>
  </div>
</div>

<div class="card hidden" id="settingsPage">
  <div style="padding:20px">
    <h3>⚙️ Settings</h3>
    <label>Keepa API Key</label>
    <input id="keepaKey" type="password" style="width:100%;margin:8px 0" />
    <label>Gemini API Key</label>
    <input id="geminiKey" type="password" style="width:100%;margin:8px 0" />
    <button id="saveSettings" style="background:var(--green);width:100%;margin-top:12px">Save</button>
    <button id="backFromSettings" style="width:100%;margin-top:8px">Back</button>
  </div>
</div>

<div class="actions">
  <button id="downloadBtn" class="btn-download">Download</button>
  <button id="clearBtn" class="btn-clear">Clear</button>
</div>
</div>

<script>
/* ================= STATE ================= */
const scanInput=document.getElementById('scanInput');
const statusText=document.getElementById('statusText');
const resultCard=document.getElementById('resultCard');
const resultText=document.getElementById('resultText');
const decisionEl=document.getElementById('decision');
const settingsPage=document.getElementById('settingsPage');
let lastLength=0;let scanning=false;let queue=0;

/* ================= SCANNER BURST FIX ================= */
scanInput.addEventListener('input',()=>{
  const val=scanInput.value.trim();
  if(!scanning && val.length>=10 && val.length-lastLength>=8){
    scanning=true;finalizeScan(val)
  }
  lastLength=val.length
});

scanInput.addEventListener('keydown',e=>{
  if(e.key==='Enter'){e.preventDefault();finalizeScan(scanInput.value.trim())}
});

function finalizeScan(code){
  if(!code)return;
  scanInput.value='';lastLength=0;scanning=false;
  if(navigator.vibrate)navigator.vibrate(40);
  statusText.textContent=`Processing ${code}`;
  processItem(code)
}

/* ================= MOCK PROCESSING (Keepa safe) ================= */
function processItem(code){
  setTimeout(()=>{
    queue++;document.getElementById('itemCount').textContent=`Queue: ${queue}`;
    decisionEl.textContent='ACCEPT';
    resultText.innerHTML=`<strong>${code}</strong><br>Profit looks good.`;
    resultCard.classList.remove('hidden');
    statusText.textContent='Ready to scan'
  },400)
}

/* ================= SETTINGS ================= */
document.getElementById('settingsBtn').onclick=()=>{
  settingsPage.classList.remove('hidden');resultCard.classList.add('hidden')
};

document.getElementById('backFromSettings').onclick=()=>{
  settingsPage.classList.add('hidden')
};

document.getElementById('saveSettings').onclick=()=>{
  localStorage.setItem('keepaKey',document.getElementById('keepaKey').value.trim());
  localStorage.setItem('geminiKey',document.getElementById('geminiKey').value.trim());
  alert('Settings saved');settingsPage.classList.add('hidden')
};

/* ================= CLEAR ================= */
document.getElementById('clearBtn').onclick=()=>{
  queue=0;document.getElementById('itemCount').textContent='Queue: 0';
  resultCard.classList.add('hidden');statusText.textContent='Ready to scan'
};
</script>
</body>
</html>
